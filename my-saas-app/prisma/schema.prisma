generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"  // ğŸ‘ˆ ÙƒØ§Ù†Øª sqliteØŒ Ø§Ø¬Ø¹Ù„Ù‡Ø§ postgresql
  url      = env("DATABASE_URL")
}
// ---------------------------------------------------------
// ğŸ‘¤ 1. Client (Ø§Ù„Ø·Ø¨ÙŠØ¨ / Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù†Ø¸Ø§Ù…)
// ---------------------------------------------------------
model Client {
  id                  String    @id @default(uuid())
  email               String    @unique
  password            String
  doctorName          String
  clinicName          String?
  role                String    @default("Doctor") // Doctor, Admin
  status              String    @default("Active")
  plan                String    @default("Free")
  specialty  String?  // Ø§Ù„ØªØ®ØµØµ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  onboardingCompleted Boolean   @default(false)
  prescriptions Prescription[]
  phone     String?  // Ø§Ù„Ù‡Ø§ØªÙ
  address   String?  // Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
  city      String?  // Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
  messages   Message[] 
  
  nextPaymentDate     DateTime?
  lastPaymentDate     DateTime?
  createdAt           DateTime  @default(now())

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª (Ù…Ø§Ø°Ø§ ÙŠÙ…Ù„Ùƒ Ø§Ù„Ø·Ø¨ÙŠØ¨ØŸ)
  patients            Patient[]
  appointments        Appointment[]
  invoices            Invoice[]
  
  subscriptions       SubscriptionPayment[]
  notifications       Notification[]
  
  // Ø¹Ù„Ø§Ù‚Ø© 1-1 Ù…Ø¹ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  onboardingProfile   OnboardingProfile?
  clinicProfile       ClinicProfile?
  
  documents Document[]
  // ... Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ...
  subscriptionStatus String @default("INACTIVE") // ACTIVE, INACTIVE, PENDING
  paymentRequests    PaymentRequest[]
  supportMessages SupportMessage[]
  // ACTIVE, INACTIVE
  subscriptionEndsAt DateTime?  // ğŸ‘ˆ Ù‡Ø°Ø§ Ù‡Ùˆ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¯Ù‚ÙŠÙ‚
  
  
}

// ---------------------------------------------------------
// ğŸ¥ 2. Patient (Ø§Ù„Ù…Ø±ÙŠØ¶)
// ---------------------------------------------------------
model Patient {
  id          String   @id @default(uuid())
  firstName   String
  lastName    String
  
  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„
  email       String?
  phone       String?
  cin         String?
  address     String?
  city        String?
  emergencyName  String?
  emergencyPhone String?
  notes       String?

  // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© (Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª Ø®Ø·Ø£Ù‹ ÙÙŠ Ù…ÙˆØ¯ÙŠÙ„ Client)
  birthDate   DateTime?
  gender      String?
  bloodType   String?
  allergies   String?
  chronicDiseases String?
  currentMedications String?

  status      String   @default("Active")
  
  // Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¨
  clientId    String
  client      Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  
  // Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶
  appointments     Appointment[]
  patientDocuments PatientDocument[] 
  invoices         Invoice[]

  createdAt   DateTime @default(now())
documents Document[]
prescriptions Prescription[]
  
}
model SystemSetting {
  key   String @id  // Ù…Ø«Ø§Ù„: "BANK_RIB", "BANK_NAME"
  value String
}
model PaymentRequest {
  id        String   @id @default(uuid())
  amount    Float
  receiptUrl String? // Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ÙˆØµÙ„
  status    String   @default("PENDING") // PENDING, APPROVED, REJECTED
  method    String   @default("BANK_TRANSFER")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  clientId  String
  client    Client   @relation(fields: [clientId], references: [id])
}

// ---------------------------------------------------------
// ğŸ“… 3. Appointment (Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯)
// ---------------------------------------------------------
model Appointment {
  id        String   @id @default(uuid())
  date      DateTime
  type      String
  status    String   @default("Scheduled")
  notes     String?
  price     Float    @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  clientId  String
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  patientId String
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

// ---------------------------------------------------------
// ğŸ“‚ 4. PatientDocument (Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª)
// ---------------------------------------------------------
model PatientDocument {
  id        String   @id @default(uuid())
  name      String
  url       String
  tags      String?
  createdAt DateTime @default(now())

  patientId String
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
}
model Message {
  id        String   @id @default(cuid())
  content   String
  role      String   // "ADMIN" or "USER"
  createdAt DateTime @default(now())
  
  // ğŸ‘‡ ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø³Ø·Ø± Ù„Ø±Ø¨Ø· Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø¹Ù…ÙŠÙ„
  clientId  String
  client    Client   @relation(fields: [clientId], references: [id])
}

// ---------------------------------------------------------
// ğŸ’° 5. Invoice (Ø§Ù„ÙÙˆØ§ØªÙŠØ±)
// ---------------------------------------------------------
model Invoice {
  id        String   @id @default(uuid())
  amount    Float
  status    String   @default("Pending") // Paid, Pending, Cancelled
  date      DateTime @default(now())
  
  clientId  String
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  
  patientId String
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
}

// ---------------------------------------------------------
model SupportMessage {
  id        String   @id @default(uuid())
  phone     String?  // Ø§Ø®ØªÙŠØ§Ø±ÙŠ (Ù„Ø£Ù† Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø¹Ù†Ø¯Ù†Ø§)
  message   String
  status    String   @default("PENDING")
  createdAt DateTime @default(now())

  // âœ… Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ù„ÙƒÙ† Ù†Ø¬Ø¹Ù„Ù‡Ø§ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (Optional)
  clientId  String?  // Ù„Ø§Ø­Ø¸ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø§Ø³ØªÙÙ‡Ø§Ù… ØŸ
  client    Client?  @relation(fields: [clientId], references: [id])
}
// ğŸ’³ 7. Subscription (Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ¨)
// ---------------------------------------------------------
model SubscriptionPayment {
  id        String   @id @default(uuid())
  amount    Float
  period    String
  status    String   @default("Pending")
  proofUrl  String?
  date      DateTime @default(now())
  
  clientId  String
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

// ---------------------------------------------------------
// ğŸ”” 8. Notification (Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª)
// ---------------------------------------------------------
model Notification {
  id        String   @id @default(uuid())
  title     String
  message   String
  type      String
  isRead    Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())
  
  clientId  String
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

// ---------------------------------------------------------
// âš™ï¸ 9. Settings (Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©)
// ---------------------------------------------------------

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø¹Ø§Ù…Ø© (SaaS)
model SaasSettings {
  id           String   @id @default("config")
  monthlyPrice Float    @default(50.0)
  yearlyPrice  Float    @default(500.0)
  bankName     String   @default("CIH Bank")
  accountName  String   @default("Admin")
  rib          String   @default("0000 0000 0000 0000")
  trialDays    Int      @default(7)
  updatedAt    DateTime @updatedAt
}

// Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
model SystemLog {
  id        String   @id @default(uuid())
  action    String
  details   String
  actor     String
  createdAt DateTime @default(now())
}

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© (Onboarding)
model OnboardingProfile {
  id       String @id @default(uuid())
  clientId String @unique
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // 1. Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
  specialty   String?
  phoneNumber String?
  city        String?
  teamSize    String?

  // 2. Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ù…Ù„
  appointmentSystem String?
  dailyPatients     String?
  patientReminders  Boolean @default(false)

  // 3. Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ÙÙˆØªØ±Ø©
  storeMedicalFiles Boolean @default(false)
  fileTypes         String?
  billingEnabled    Boolean @default(false)
  paymentMethods    String?

  // 4. Ø§Ù„ÙØ±ÙŠÙ‚ ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  hasAssistants        Boolean @default(false)
  assistantsCount      Int     @default(0)
  assistantPermissions String?
  
  language String @default("fr")
  currency String @default("MAD")
  mainProblem String?

  createdAt DateTime @default(now())
}

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© (Ù„Ù„ÙˆÙ† ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©)
model ClinicProfile {
  id        String   @id @default(uuid())
  settings  String   // JSON string storing { color, printHeader, etc }
  
  clientId  String   @unique
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

// Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
model Document {
  id        String   @id @default(uuid())
  name      String   // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù (Ù…Ø«Ù„Ø§Ù‹: X-Ray Report)
  type      String   // Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù (PDF, JPG, PNG)
  url       String   // Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù (Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø±Ø§Ø¨Ø· ÙˆÙ‡Ù…ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹)
  
  patientId String
  patient   Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  clientId  String
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}
model Prescription {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  
  // Ø³Ù†Ø®Ø²Ù† Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ù†Øµ JSON Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§
  // Ù…Ø«Ø§Ù„: [{"name": "Panadol", "dose": "500mg", "freq": "3x Daily"}]
  medications String   
  
  notes     String?  // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©

  patientId String
  patient   Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)

  clientId  String
  client    Client  @relation(fields: [clientId], references: [id])
}


// Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù
model SystemSettings {
  id          String   @id @default(uuid())
  
  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  monthlyPrice Float    @default(300)
  currency     String   @default("MAD")

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ (Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹)
  bankName     String   @default("CIH Bank")
  rib          String   @default("0000 1111 2222 3333 4444")
  accountName  String   @default("My SaaS Company")
// âœ… Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ 2 (Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© - Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)
  extraMethodName   String   @default("") // Ù…Ø«Ù„Ø§Ù‹: Cash Plus
  extraMethodNumber String   @default("") // Ù…Ø«Ù„Ø§Ù‹: Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
  extraMethodOwner  String   @default("") // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…
  paymentNote       String   @default("")
  updatedAt    DateTime @updatedAt
}